<!DOCTYPE html><html lang="en-US">
<!-- Mirrored from bholmes.dev/blog/writing-a-state-machine-in-one-line-with-typescript/ by HTTrack Website Copier/3.x [XR&CO'2014], Wed, 16 Mar 2022 05:57:50 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- /Added by HTTrack -->
<head><link rel="stylesheet" href="__styles.html"><link rel="stylesheet" href=../../_layouts/__styles.css><link rel="stylesheet" href=../../_layouts/blog-post/__styles.css><title>Writing a state machine in one line with TypeScript</title><link rel="preload" href="https://use.typekit.net/liz3dnm.css" as="style"/><link rel="preload" href="../../assets/fonts/Atkinson/Atkinson-Hyperlegible-Regular.woff2" as="font" crossorigin="anonymous"/><link rel="preload" href="../../assets/fonts/Atkinson/Atkinson-Hyperlegible-Bold.woff2" as="font" crossorigin="anonymous"/><link rel="preload" href="../../assets/fonts/Atkinson/Atkinson-Hyperlegible-Italic.woff2" as="font" crossorigin="anonymous"/><link rel="preload" href="../../assets/fonts/Atkinson/Atkinson-Hyperlegible-BoldItalic.woff2" as="font" crossorigin="anonymous"/><link rel="stylesheet" href="https://use.typekit.net/liz3dnm.css"/><link rel="icon" type="img/jpg" href="../../assets/favicon.jpg"/><link rel="canonical" href="index.html"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><!-- TODO: automatically generate these at buildtime--><link rel="modulepreload" href="__client.html"/><link rel="modulepreload" href="__data.html"/><link rel="modulepreload" href="../../_layouts/__client.mjs"/><link rel="modulepreload" href="../../_layouts/__data.mjs"/><link rel="preload" as="fetch" href="../../index-2.html"/><link rel="preload" as="fetch" href="../../work/index.html"/><link rel="preload" as="fetch" href="../../contact/index.html"/><meta name="author" content="Ben Holmes"/><meta name="twitter:card" content="summary_large_image"/><meta name="twitter:site" content="@bholmesdev"/><meta name="twitter:creator" content="@bholmesdev"/><meta name="description" content="State machines aren't just a nice library (hi XState); they're a way of thinking about your state. Let's jump into an example using TypeScript."/><meta property="og:url" content="index.html"/><meta property="og:image" content="https://dev-to-uploads.s3.amazonaws.com/i/1lgj7pu6xwrb23k01k7j.jpg"/><meta property="og:image:width" content="1200"/><meta property="og:image:height" content="630"/><meta property="og:site_name" content="Ben Holmes"/><meta property="og:title" content="Writing a state machine in one line with TypeScript"/><meta property="og:description" content="State machines aren't just a nice library (hi XState); they're a way of thinking about your state. Let's jump into an example using TypeScript."/><!-- Analytics--><script async="async" defer="defer" data-domain="bholmes.dev" src="https://stats.bholmes.dev/js/index.js"></script></head><body><div id="loading-spinner" aria-label="loading"><div class="loading-spinner__graphic"><div class="loading-spinner__graphic--dash"></div><div class="loading-spinner__graphic--dash"></div><div class="loading-spinner__graphic--dash"></div></div></div><nav id="site-navigation"><div class="jump-to-section__container"><button id="jump-to-section__toggle" aria-label="Reveal table of contents"><span>0</span><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path d="M128 192l128 128 128-128z"/></svg></button><div class="jump-to-section__label-container"><p id="jump-to-section__label"></p></div><ul id="jump-to-section__links"></ul></div><div class="primary-nav__container"><ul id="primary-nav__links"><li><a href="../../index.html">Ben</a></li><li><a class="active" href="../index.html">Blog</a></li><li><a href="../../work/index-2.html">Works</a></li><li><a href="../../contact/index-2.html">Contact</a></li></ul><button id="primary-nav__toggle" aria-label="Reveal navigation links"><div class="stripe-top"></div><div class="stripe-middle"></div><div class="stripe-bottom"></div></button></div></nav><div id="loading-spinner" aria-label="loading"><div class="loading-spinner__graphic"><div class="loading-spinner__graphic--dash"></div><div class="loading-spinner__graphic--dash"></div><div class="loading-spinner__graphic--dash"></div></div></div><div data-page="_layouts/blog-post"><main><article data-page="blog/writing-a-state-machine-in-one-line-with-typescript"><header><picture><source type="image/webp" srcset="/assets/pug-images/9e43ebf8-600.webp 600w, /assets/pug-images/9e43ebf8-800.webp 800w, /assets/pug-images/9e43ebf8-1400.webp 1400w" sizes="(min-width: 800px) 720px, 100vw"><source type="image/jpeg" srcset="/assets/pug-images/9e43ebf8-600.jpeg 600w, /assets/pug-images/9e43ebf8-800.jpeg 800w, /assets/pug-images/9e43ebf8-1400.jpeg 1400w" sizes="(min-width: 800px) 720px, 100vw"><img alt="State machines aren't just a nice library (hi XState); they're a way of thinking about your state. Let's jump into an example using TypeScript." loading="lazy" decoding="async" widths="800,1000,1400" src="../../assets/pug-images/9e43ebf8-600.jpg" width="1400" height="585"></picture><h1>Writing a state machine in one line with TypeScript</h1><p class="details"><span><strong>5</strong> minute read</span><span class="spacer">‚Ä¢</span><span>Last updated <time pubdate="pubdate" datetime="2020-09-02T15:35:45.152Z">September 2, 2020</time></span></p></header><div><p>Ah yes, state machines. That thing <a href="https://twitter.com/DavidKPiano" target="_blank" rel="noreferrer">David K Piano</a> keeps tweeting about, or that CS concept that pops up in college once a semester (and seemingly never returns...). As the frontend world gets more and more disatisfied with Redux, state machines are <a href="https://mobx.js.org/README.html" target="_blank" rel="noreferrer">one</a> <a href="https://rxjs-dev.firebaseapp.com/" target="_blank" rel="noreferrer">of</a> <a href="https://github.com/facebookexperimental/Recoil" target="_blank" rel="noreferrer"><em>many</em></a> <a href="https://www.apollographql.com/docs/react/" target="_blank" rel="noreferrer">concepts</a> devs are talking about these days.</p>
<p>But unlike Redux et al., <strong>state machines don't have to be a library you install into your project!</strong> Once you understand them conceptually, they become their own way of thinking about problems.</p>
<p><strong>In short, this article should help you...</strong></p>
<ol>
<li>Identify when boolean flags and state variables are getting too complex</li>
<li>Write your own scrappy state machine with no libraries</li>
<li>Learn a bit more about state machines as a concept, and when XState might be a good idea</li>
</ol>
<p>Onwards!</p>
<p>‚ö†Ô∏è <em><strong>Note:</strong> we'll be using React for the following examples. Still, the core learning concepts transfer to any frontend framework</em></p>
<h2 id="link-first-a-scenario">First, a scenario</h2>
<p>If we're talking UI complexity, form management is the easiest place to look. Let's say we have a simple sign-up screen we need to implement with a username and password. To make things a little interesting, let's say we're reviving the incredible childhood memory that is <a href="https://cprewritten.net/" target="_blank" rel="noreferrer">Club Penguin</a>!</p>
<p><picture><source type="image/webp" srcset="/assets/md-images/76f60794-600.webp 600w, /assets/md-images/76f60794-1000.webp 1000w, /assets/md-images/76f60794-1400.webp 1400w" sizes="(min-width: 800px) 720px, 100vw"><source type="image/jpeg" srcset="/assets/md-images/76f60794-600.jpeg 600w, /assets/md-images/76f60794-1000.jpeg 1000w, /assets/md-images/76f60794-1400.jpeg 1400w" sizes="(min-width: 800px) 720px, 100vw"><img alt="A hideously-perfect club penguin signup screen" loading="lazy" decoding="async" src="../../assets/md-images/76f60794-600.jpg" width="1400" height="1177"></picture></p>
<p><em>Try not the cringe. At least it's not built on Flash</em> üò¨</p>
<p>We also want to consider some scenarios as the user fills out the form. Namely, we should support <strong>a) password validation before you submit</strong> and <strong>b) disabling the submit button while we're sending to the API.</strong> Here's what that flow might look like:</p>
<p><img src="https://dev-to-uploads.s3.amazonaws.com/i/trzz468dhfgnv9lq798w.gif" alt="A gif explaining the signup process, with "password invalid" popup and bottom submission states" loading="lazy"  /></p>
<h2 id="link-a-common-approach-brute-force-booleans">A common approach: brute-force booleans</h2>
<p>First, let's cover the approach a lot of devs might take <a href="https://hackernoon.com/handling-loading-actions-the-proper-way-in-redux-t3k36e8" target="_blank" rel="noreferrer">(especially coming from a Redux background)</a>. Based on the interactions we want, we should probably have some flags for</p>
<ol>
<li>When the password is invalid</li>
<li>When we're submitting to the API</li>
<li>Whether we've submitted successfully (maybe to move to the next screen)</li>
</ol>
<p>I won't bore you with the HTML + <em>colorful</em> CSS we need (check this <a href="https://codesandbox.io/s/forms-the-bad-way-mvm2w" target="_blank" rel="noreferrer">CodeSandbox</a> for such goodies!), so let's just look at the pieces we care about:</p>
<pre class="language-tsx"><code class="language-tsx"><span class="token keyword">const</span> <span class="token function-variable function">ClubPenguinSignup</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>invalid<span class="token punctuation">,</span> setInvalid<span class="token punctuation">]</span> <span class="token operator">=</span> React<span class="token punctuation">.</span><span class="token function">useState</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>submitting<span class="token punctuation">,</span> setSubmitting<span class="token punctuation">]</span> <span class="token operator">=</span> React<span class="token punctuation">.</span><span class="token function">useState</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>submitted<span class="token punctuation">,</span> setSubmitted<span class="token punctuation">]</span> <span class="token operator">=</span> React<span class="token punctuation">.</span><span class="token function">useState</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token operator">...</span>
  <span class="token comment">// state vars for username and password, markup, etc.</span>
<span class="token punctuation">}</span>
</code></pre>
<p>For the submitting / submitted flags, we can use a nice callback function for whenever our form submits:</p>
<pre class="language-tsx"><code class="language-tsx"><span class="token keyword">const</span> <span class="token function-variable function">onSubmit</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">event<span class="token operator">:</span> React<span class="token punctuation">.</span>FormEvent</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
  event<span class="token punctuation">.</span><span class="token function">preventDefault</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">setSubmitting</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// we're now submitting</span>
  <span class="token keyword">const</span> addedUser <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">arcticAuthService</span><span class="token punctuation">(</span><span class="token punctuation">{</span> username<span class="token punctuation">,</span> password <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>addedUser<span class="token operator">?.</span>success<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// if signup call worked...</span>
    <span class="token function">setSubmitting</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// we're no longer submitting</span>
  	<span class="token function">setSubmitted</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// we've submitted</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre>
<p>Finally, we can make a super basic callback to validate our password as the user types it in. In this case, we'll listen for whenever the input's value changes (i.e. using a <a href="https://goshakkk.name/controlled-vs-uncontrolled-inputs-react/" target="_blank" rel="noreferrer">controlled input</a>), and run the value through an insecure phrase checker:</p>
<pre class="language-tsx"><code class="language-tsx"><span class="token keyword">const</span> <span class="token function-variable function">onChangePassword</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">event<span class="token operator">:</span> React<span class="token punctuation">.</span>FormEvent<span class="token operator">&lt;</span>HTMLInputElement<span class="token operator">></span></span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
  <span class="token function">setPassword</span><span class="token punctuation">(</span>event<span class="token punctuation">.</span>currentTarget<span class="token punctuation">.</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">checkPasswordSecurity</span><span class="token punctuation">(</span>event<span class="token punctuation">.</span>currentTarget<span class="token punctuation">.</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> <span class="token function-variable function">checkPasswordSecurity</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">changedPassword<span class="token operator">:</span> string</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> insecure <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span> <span class="token comment">// we first assume the value is secure (excuse the double negative)</span>
  <span class="token punctuation">[</span><span class="token string">"club"</span><span class="token punctuation">,</span> <span class="token string">"penguin"</span><span class="token punctuation">,</span> <span class="token string">"puffle"</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">badWord</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>changedPassword<span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span>badWord<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      insecure <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">setInvalid</span><span class="token punctuation">(</span>insecure<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre>
<h3 id="link-where-it-starts-to-get-hairy">Where it starts to get hairy</h3>
<p>Great! This doesn't seem too bad... but we're not done yet. If you check that mockup again, you'll notice that our button has 3 different indicators to display (normal, loading, and finished). Since we're using separate boolean flags for each of these, we'll need some mappers to set the button backgrounds + flavor text:</p>
<pre class="language-tsx"><code class="language-tsx"><span class="token keyword">const</span> getButtonLabel <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token parameter">string</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>submitting<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token string">"‚Ä¢‚Ä¢‚Ä¢"</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>submitted<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token string">"Time to play!"</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token string">"Let's get sliding!"</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> getButtonClass <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token parameter">string</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>submitting<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token string">"submitting"</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>submitted<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token string">"submitted"</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>invalid<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token string">"invalid"</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token string">""</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">return</span> <span class="token punctuation">(</span>
	<span class="token operator">...</span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>submit<span class="token punctuation">"</span></span> <span class="token attr-name">className</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token function">getButtonClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token punctuation">></span></span><span class="token plain-text">
    </span><span class="token punctuation">{</span><span class="token function">getButtonLabel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token plain-text">
  </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">></span></span>
<span class="token punctuation">)</span>
</code></pre>
<p>Since we only need mappers for a single element, this doesn't seem <em>that</em> terrible. Still, this could easily start ballooning out of control as we add more UI and more state variables...</p>
<pre class="language-tsx"><code class="language-tsx"><span class="token keyword">const</span> <span class="token punctuation">[</span>usenameTaken<span class="token punctuation">,</span> setUsernameTaken<span class="token punctuation">]</span> <span class="token operator">=</span> React<span class="token punctuation">.</span><span class="token function">useState</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token punctuation">[</span>apiError<span class="token punctuation">,</span> setApiError<span class="token punctuation">]</span> <span class="token operator">=</span> React<span class="token punctuation">.</span><span class="token function">useState</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token punctuation">[</span>serverAtMaxCapacity<span class="token punctuation">,</span> setServerAtMaxCapacity<span class="token punctuation">]</span> <span class="token operator">=</span> React<span class="token punctuation">.</span><span class="token function">useState</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token punctuation">[</span>invalid<span class="token punctuation">,</span> setInvalid<span class="token punctuation">]</span> <span class="token operator">=</span> React<span class="token punctuation">.</span><span class="token function">useState</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token punctuation">[</span>submitting<span class="token punctuation">,</span> setSubmitting<span class="token punctuation">]</span> <span class="token operator">=</span> React<span class="token punctuation">.</span><span class="token function">useState</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token punctuation">[</span>submitted<span class="token punctuation">,</span> setSubmitted<span class="token punctuation">]</span> <span class="token operator">=</span> React<span class="token punctuation">.</span><span class="token function">useState</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> getButtonClass <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token parameter">string</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
  <span class="token comment">// 100 lines of ifs</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre>
<p>We're also allowing for a lot of states that shouldn't be possible. For example, we should never be &quot;submitting&quot; and &quot;submitted&quot; at the same time, and neither of these should be <code>true</code> when the password is invalid. Considering the crazy state explosion above, we'll end up restling all these variables to prevent such invalid states.</p>
<pre class="language-ts"><code class="language-ts"><span class="token comment">// api responds that servers are at max capacity, so no sign ups allowed</span>
<span class="token function">setServerAtMaxCapacity</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span>
<span class="token function">setSubmitting</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span>
<span class="token function">setSubmitted</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span>
<span class="token function">setApiError</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span>
<span class="token operator">...</span>
</code></pre>
<p>If anything, we just want to have a boolean with more than 2 values so we're not switching flags all over the place. Luckily, <em>TypeScript gives us such superpowers</em> üí™</p>
<h2 id="link-our-new-approach-the-poor-mans-state-machine">Our new approach: the poor man's state machine</h2>
<p>As you may have guessed, we can solve this boolean bonanza with a simple state machine. I've heard this approach called the &quot;<a href="https://twitter.com/housecor/status/1292111064314851329" target="_blank" rel="noreferrer">poor man's state machine</a>&quot; which is a super apt title as well!</p>
<p>All we need is <s>the XState library</s> a one-liner to model our state variables as a single type:</p>
<pre class="language-ts"><code class="language-ts"><span class="token keyword">type</span> <span class="token class-name">FormState</span> <span class="token operator">=</span> <span class="token string">'idle'</span> <span class="token operator">|</span> <span class="token string">'invalid'</span> <span class="token operator">|</span> <span class="token string">'submitting'</span> <span class="token operator">|</span> <span class="token string">'submitted'</span>
</code></pre>
<p>You could certainly use an enum for this as well. I just prefer string literals since they're a bit shorter + more readable (I also wrote a <a href="https://dev.to/bholmesdev/using-enums-with-string-values-in-typescript-consider-string-literals-instead-486e" target="_blank" rel="noreferrer">short article on the subject</a> if you're still an enum stan).</p>
<p>With our type defined, we can condense all our state variables into one:</p>
<pre class="language-tsx"><code class="language-tsx"><span class="token keyword">const</span> <span class="token punctuation">[</span>formState<span class="token punctuation">,</span> setFormState<span class="token punctuation">]</span> <span class="token operator">=</span> React<span class="token punctuation">.</span><span class="token generic-function"><span class="token function">useState</span><span class="token generic class-name"><span class="token operator">&lt;</span>FormState<span class="token operator">></span></span></span><span class="token punctuation">(</span><span class="token string">"idle"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p>Refactoring our password and submit callback is pretty easy from here.</p>
<pre class="language-tsx"><code class="language-tsx"><span class="token keyword">const</span> <span class="token function-variable function">checkIfPasswordIsSecure</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">changedPassword<span class="token operator">:</span> string</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
    <span class="token function">setFormState</span><span class="token punctuation">(</span><span class="token string">"idle"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// not invalid yet</span>
    <span class="token punctuation">[</span><span class="token string">"club"</span><span class="token punctuation">,</span> <span class="token string">"penguin"</span><span class="token punctuation">,</span> <span class="token string">"puffle"</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">badWord</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>changedPassword<span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span>badWord<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">setFormState</span><span class="token punctuation">(</span><span class="token string">"invalid"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// oops! Looks like it's invalid after all</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> <span class="token function-variable function">onSubmit</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">event<span class="token operator">:</span> React<span class="token punctuation">.</span>FormEvent</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
  event<span class="token punctuation">.</span><span class="token function">preventDefault</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>formState <span class="token operator">===</span> <span class="token string">"invalid"</span><span class="token punctuation">)</span> <span class="token keyword">return</span><span class="token punctuation">;</span> <span class="token comment">// don't submit if our password is invalid</span>
  <span class="token function">setFormState</span><span class="token punctuation">(</span><span class="token string">"submitting"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> addedUser <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">arcticAuthService</span><span class="token punctuation">(</span><span class="token punctuation">{</span> username<span class="token punctuation">,</span> password <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>addedUser<span class="token operator">?.</span>id<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  	<span class="token function">setFormState</span><span class="token punctuation">(</span><span class="token string">"submitted"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// no need to set submitting to false, since we don't have 2 states to consider anymore!</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre>
<p>And remember those button <code>className</code>s we needed to map? Well, since our state is represented as a string, we can just pass these directly to our CSS ‚ú®</p>
<pre class="language-tsx"><code class="language-tsx"><span class="token keyword">return</span> <span class="token punctuation">(</span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>submit<span class="token punctuation">"</span></span> <span class="token attr-name">className</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>formState <span class="token comment">/* our state is our CSS */</span><span class="token punctuation">}</span></span><span class="token punctuation">></span></span><span class="token plain-text">
		...
  </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">></span></span>
<span class="token punctuation">)</span>
</code></pre>
<p>This approach is super handy for keeping our CSS in check; instead of constantly adding and removing classes, we can just switch out which class gets applied.</p>
<p><strong><a href="https://codesandbox.io/s/club-penguin-with-state-machines-1klrq?file=/src/styles.css" target="_blank" rel="noreferrer">Here's a working CodeSandbox</a> using our new approach ‚ú®</strong></p>
<h2 id="link-going-further">Going further üöÄ</h2>
<p>Of course, this is a pretty simple example that may not <em>quite</em> fit your use case. For example, you may want to be in multiple states at a given time, or guard against &quot;invalid transitions&quot; (for example, it shouldn't be possible to go from <code>idle</code> to <code>submitted</code> without passing through <code>submitting</code> first).</p>
<p>The former could just require multiple state variables, so consider creating multiple <code>FormState</code> types to see how it feels. Still, you may have enough complexity that a state management library makes a lot of sense. Check out <a href="https://xstate.js.org/docs/" target="_blank" rel="noreferrer">XState</a> if this sounds like you!</p>
<p>To get your feet wet, I found a couple high quality demos around the Internet worth checking out:</p>
<ul>
<li><strong><a href="https://www.youtube.com/watch?v=czi24DqUfSA" target="_blank" rel="noreferrer">This one</a> on building a more complex ReactJS form.</strong> It's long, but worth your time!</li>
<li><strong><a href="https://www.youtube.com/watch?v=osaszd2aU9U" target="_blank" rel="noreferrer">This one</a> on creating a Vanilla JS drag-and-drop interaction.</strong> This is more CSS-intensive and speaks to the <code>className</code> trick I showed above.</li>
<li><strong><a href="https://www.youtube.com/watch?v=hiT4Q1ntvzg" target="_blank" rel="noreferrer">This one</a> on modeling UI with state machines across frameworks.</strong> Best conference talk on the subject hands down.</li>
</ul>
</div><hr/><footer><p>Learn a little something? <strong><a href="https://twitter.com/intent/tweet?text=Woah,%20I%20learned%20so%20much%20from%20this!%20%22Writing%20a%20state%20machine%20in%20one%20line%20with%20TypeScript%22%20by%20@bholmesdev%20https://bholmes.dev/blog/writing-a-state-machine-in-one-line-with-typescript/" target="_blank" rel="noreferrer">Share this post</a> on Twitter!</strong></p><section class="about-the-author"><img src="../../assets/images/me.jpg" alt="Hand drawn portrait of Ben Holmes"/><div><address><a rel="author" href="../../index.html">Ben Holmes </a></address>is a web developer + UI designer by trade from Charleston SC. He's been tinkering with JavaScript and CSS since 2014, and has lead a <a href="https://hack4impact.org/dev-bootcamp">full stack bootcamp curriculum</a> used by universities across the country. Now, he's working fulltime at Peloton and teaching the world a bit of web whimsy in his spare time.</div></section></footer></article></main><footer><div class="content"><div class="newsletter"><h2>Woah, there's a newsletter too!</h2><form action="https://tinyletter.com/bholmesdev" method="post" target="_blank"><label for="email">Email</label><input id="email" type="email" name="email" placeholder="10xengineer@genius.club" required="required"/><p class="newsletter__never-spam">Don't worry, I won't spam you</p><button class="cta-link" type="submit">Yes please, more content<svg xmlns="http://www.w3.org/2000/svg" fill="#5f4b32" width="34" height="34" viewBox="0 0 512 512"><path d="M48 270.9l118.9 44.6L181.7 464 256 360l104 104L464 48 48 270.9zm294.9 126L260 313.4 374.9 152 193.6 289.8 124.9 265l291-156.2-73 288.1z"/></svg></svg></button></form></div><div class="socials"><div class="socials__links"><a href="https://dev.to/bholmesdev" target="_blank" rel="noreferrer" aria-label="Ben's DEV.to blog"><svg xmlns="http://www.w3.org/2000/svg" fill="#5f4b32" width="34" height="34" viewBox="0 0 34 34"><path d="M18.119,22.38a1.48,1.48,0,0,0-.881-.33H15.917v7.929h1.321a1.449,1.449,0,0,0,.881-.33,1.172,1.172,0,0,0,.44-.991V23.371a1.172,1.172,0,0,0-.44-.991ZM39.669,9H12.331A3.332,3.332,0,0,0,9,12.324V39.676A3.332,3.332,0,0,0,12.331,43H39.669A3.332,3.332,0,0,0,43,39.676V12.324A3.332,3.332,0,0,0,39.669,9ZM20.7,28.67a3.466,3.466,0,0,1-3.668,3.586H13.508V19.7H17.1a3.462,3.462,0,0,1,3.593,3.586L20.7,28.67Zm7.647-6.731H24.3v2.918h2.471V27.1H24.3v2.918h4.047v2.244H23.626a1.531,1.531,0,0,1-1.569-1.494v-9.5A1.531,1.531,0,0,1,23.55,19.7h4.8v2.237Zm7.86,8.755c-1,2.333-2.794,1.872-3.6,0L29.682,19.7h2.471l2.257,8.631L36.654,19.7h2.471L36.207,30.694Z" transform="translate(-9 -9)"/></svg></a><a href="https://twitter.com/bholmesdev" target="_blank" rel="noreferrer" aria-label="Ben's Twitter"><svg xmlns="http://www.w3.org/2000/svg" fill="#5f4b32" width="34" height="34" viewBox="0 0 34 34"><path d="M55.383,67.4a14.634,14.634,0,0,1-4.157,1.144,7.264,7.264,0,0,0,3.185-4.008,14.384,14.384,0,0,1-4.6,1.757,7.237,7.237,0,0,0-12.524,4.95,7.087,7.087,0,0,0,.187,1.652,20.514,20.514,0,0,1-14.924-7.574A7.253,7.253,0,0,0,24.8,75a7.07,7.07,0,0,1-3.29-.9v.09a7.245,7.245,0,0,0,5.809,7.1,7.287,7.287,0,0,1-1.907.254,6.829,6.829,0,0,1-1.361-.135,7.25,7.25,0,0,0,6.766,5.032,14.513,14.513,0,0,1-8.995,3.1,14.673,14.673,0,0,1-1.727-.1,20.234,20.234,0,0,0,11.081,3.275c13.331,0,20.613-11.043,20.613-20.621,0-.314-.007-.628-.022-.935A14.736,14.736,0,0,0,55.383,67.4Z" transform="translate(-20.1 -64)"/></svg></a><a href="https://github.com/holben888" target="_blank" rel="noreferrer" aria-label="Ben's GitHub"><svg xmlns="http://www.w3.org/2000/svg" fill="#5f4b32" width="34" height="34" viewBox="0 0 34 34"><path d="M10,115.987a18.6,18.6,0,0,0,.434,4.181,12.443,12.443,0,0,0,1.2,3.251,9.207,9.207,0,0,0,1.943,2.429,11.2,11.2,0,0,0,2.56,1.714,15.1,15.1,0,0,0,3.15,1.079,26,26,0,0,0,3.615.583q1.847.167,4.056.167,2.227,0,4.073-.167a26.227,26.227,0,0,0,3.626-.583,15.681,15.681,0,0,0,3.168-1.079,11.191,11.191,0,0,0,2.578-1.714,9.284,9.284,0,0,0,1.964-2.429,12.2,12.2,0,0,0,1.2-3.251A18.6,18.6,0,0,0,44,115.987a10.2,10.2,0,0,0-2.758-7.133,8.923,8.923,0,0,0,.274-.906,12.4,12.4,0,0,0,.232-1.447,8.1,8.1,0,0,0-.083-2.168,11.516,11.516,0,0,0-.708-2.512l-.25-.049a3.352,3.352,0,0,0-.874.024,9.708,9.708,0,0,0-1.412.3,12.073,12.073,0,0,0-2.078.864,24.135,24.135,0,0,0-2.685,1.6,26.284,26.284,0,0,0-6.668-.666,26.208,26.208,0,0,0-6.651.666,22.6,22.6,0,0,0-2.7-1.6,13.381,13.381,0,0,0-2.054-.864,8.05,8.05,0,0,0-1.429-.291,4.676,4.676,0,0,0-.84-.042,1.455,1.455,0,0,0-.274.059,11.462,11.462,0,0,0-.708,2.512,8.1,8.1,0,0,0-.083,2.168,12.664,12.664,0,0,0,.232,1.447,8.922,8.922,0,0,0,.274.906A10.223,10.223,0,0,0,10,115.987Zm4.174,4.174a5.879,5.879,0,0,1,2.179-4.389,4.334,4.334,0,0,1,1.513-.906,6.575,6.575,0,0,1,1.953-.347c.725-.028,1.422-.021,2.085.017s1.485.09,2.46.156,1.818.1,2.526.1,1.551-.031,2.529-.1,1.8-.118,2.46-.156,1.36-.045,2.085-.017a6.687,6.687,0,0,1,1.953.347,4.366,4.366,0,0,1,1.513.906,5.814,5.814,0,0,1,2.179,4.389,8.215,8.215,0,0,1-.357,2.536,6.367,6.367,0,0,1-.912,1.853,4.535,4.535,0,0,1-1.547,1.273,10.782,10.782,0,0,1-1.929.8,13.909,13.909,0,0,1-2.411.441c-.982.1-1.856.17-2.626.191s-1.749.035-2.935.035-2.165-.01-2.935-.035-1.644-.087-2.626-.191a13.648,13.648,0,0,1-2.411-.441,11.153,11.153,0,0,1-1.929-.8,4.535,4.535,0,0,1-1.547-1.273,6.414,6.414,0,0,1-.916-1.853A8.438,8.438,0,0,1,14.174,120.161Zm17.076-.333c0,1.759.951,3.188,2.127,3.188s2.127-1.426,2.127-3.188-.951-3.188-2.127-3.188S31.25,118.066,31.25,119.828Zm-12.75,0c0,1.759.951,3.188,2.127,3.188s2.127-1.426,2.127-3.188-.951-3.188-2.127-3.188S18.5,118.066,18.5,119.828Z" transform="translate(-10 -101.754)"/></svg></a></div><p>Follow along with <strong>Ben</strong> for the fun, for the whimsy, and for the love of building websites ‚ô• </p></div></div></footer></div></body>
          <script src="../../__main.mjs" defer></script>
          
          
<!-- Mirrored from bholmes.dev/blog/writing-a-state-machine-in-one-line-with-typescript/ by HTTrack Website Copier/3.x [XR&CO'2014], Wed, 16 Mar 2022 05:57:55 GMT -->
</html>